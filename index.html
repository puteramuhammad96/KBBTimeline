
<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KBB Timeline â€” Pro Amber v3</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsgantt-improved@2.9.3/dist/jsgantt.css">
<link rel="stylesheet" href="./assets/style.css">
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <div class="h-title">KBB Steakhouse Project Timeline</div>
      <div class="h-sub">Kuala Terengganu â€¢ Novâ€“Dec 2025</div>
    </div>
    <div class="controls">
      <div class="chip" id="overall">Overall: 0%</div>
      <button class="reset-btn" id="resetBtn">ğŸ” Reset Progress</button>
      <div class="btns" id="scale">
        <button data-format="day" class="active">Day</button>
        <button data-format="week">Week</button>
        <button data-format="month">Month</button>
      </div>
    </div>
  </div>

  <div class="grid" style="margin-top:16px">
    <div class="panel">
      <div style="font-size:12px;color:#9ca3af">Cari task</div>
      <input id="search" class="input" placeholder="Contoh: Ceiling, Signage, Plumbing"/>
    </div>
    <div class="panel" style="display:flex;align-items:center;justify-content:space-between">
      <div>
        <div style="font-size:12px;color:#9ca3af">Status</div>
        <div style="font-size:20px;color:#fbbf24" id="statusNum">0%</div>
      </div>
      <div style="text-align:right">
        <div style="font-size:12px;color:#9ca3af">Total Duration</div>
        <div style="font-size:20px" id="duration">â€”</div>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:12px;">
    <div class="gantt-wrap">
      <div class="today-line" id="todayLine"></div>
      <div class="gantt" id="GanttChartDIV"></div>
    </div>
    <div class="legend">ğŸš© Garis merah = tarikh hari ini â€¢ Hover/klik bar untuk info â€¢ Klik untuk tandakan siap â€¢ Reset untuk kosongkan status.</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jsgantt-improved@2.9.3/dist/jsgantt.js"></script>
<script>
const RAW = [["0", "KBB STEAKHOUSE, KUALA TERENGGANU", "2025-11-06", "2025-12-04", 0, 1, "0", ""], ["1", "Site Preparation", "2025-11-06", "2025-11-07", 0, 0, "0", ""], ["2", "Manufacture Site Hoarding", "2025-11-06", "2025-11-06", 0, 0, "1", ""], ["3", "Install Site Hoarding", "2025-11-07", "2025-11-07", 0, 0, "1", "2"], ["4", "Circular Wing (Cover Dining & Toilet)", "2025-11-08", "2025-12-04", 0, 1, "0", "3"], ["5", "Site Delivery", "2025-11-08", "2025-11-11", 0, 0, "4", "3"], ["6", "Marking Demolition Items/Location", "2025-11-08", "2025-11-08", 0, 0, "4", "5"], ["7", "Demolish Floor Finish, Handwash & Steel Cage", "2025-11-08", "2025-11-10", 0, 0, "4", "6"], ["8", "Erect Brickwall Exterior", "2025-11-08", "2025-11-13", 0, 0, "4", "7,5"], ["9", "Plumbing Line for Handwash Area", "2025-11-10", "2025-11-11", 0, 0, "4", "7"], ["10", "Erect Bricks at Toilet (Set Pipe)", "2025-11-11", "2025-11-12", 0, 0, "4", "9"], ["11", "Erect Brickwalls at Photo Area", "2025-11-12", "2025-11-14", 0, 0, "4", "10"], ["12", "Install Fittings at Toilet", "2025-11-13", "2025-11-14", 0, 0, "4", "8"], ["13", "Install Tiles at Toilet", "2025-11-14", "2025-11-16", 0, 0, "4", "12"], ["14", "Brickwalls & Top at Middle Column", "2025-11-14", "2025-11-16", 0, 0, "4", "11"], ["15", "Floor Tiles at Dining Area", "2025-11-16", "2025-11-20", 0, 0, "4", "14"], ["16", "Tiles at Handwash Area", "2025-11-16", "2025-11-18", 0, 0, "4", "13"], ["17", "Measurement for Glass Door", "2025-11-13", "2025-11-14", 0, 0, "4", "8"], ["23", "Ceiling Work (Frame)", "2025-11-18", "2025-11-19", 0, 0, "4", "16"], ["18", "Set Out & Material \u2013 Electrical", "2025-11-19", "2025-11-21", 0, 0, "4", "23"], ["19", "Wiring & Piping Relocation", "2025-11-21", "2025-11-23", 0, 0, "4", "18"], ["20", "Set Out & Material \u2013 Aircond", "2025-11-23", "2025-11-24", 0, 0, "4", "19"], ["21", "Aircond Installation", "2025-11-24", "2025-11-25", 0, 0, "4", "20"], ["37", "Install Ceiling", "2025-11-23", "2025-11-25", 0, 0, "30", "36,35"], ["22", "Plastering Work", "2025-11-25", "2025-11-29", 0, 0, "4", "15,19,37"], ["24", "Ceiling Finishes", "2025-11-25", "2025-11-26", 0, 0, "4", "21,23,39"], ["40", "Paint Work (Main Wing)", "2025-11-25", "2025-11-28", 0, 0, "30", "37"], ["41", "Install Cabinetry (Main Wing)", "2025-11-28", "2025-11-29", 0, 0, "30", "40"], ["25", "Paint Work (Circular Wing)", "2025-11-29", "2025-12-02", 0, 0, "4", "22,24"], ["26", "Install Cabinetry (Circular Wing)", "2025-11-29", "2025-11-30", 0, 0, "4", "41"], ["27", "Install Steel Structure", "2025-11-30", "2025-12-02", 0, 0, "4", "26"], ["28", "Install Signage (Circular Wing)", "2025-12-02", "2025-12-04", 0, 0, "4", "25,27"], ["29", "Install Door", "2025-12-02", "2025-12-04", 0, 0, "4", "28,17"], ["30", "Main Wing", "2025-11-16", "2025-12-04", 0, 1, "0", ""], ["31", "Demolish Floor Finish (Main)", "2025-11-16", "2025-11-19", 0, 0, "30", "15"], ["32", "Demolish Wall Finish to Exposed Brick", "2025-11-16", "2025-11-19", 0, 0, "30", "31"], ["33", "Demolish Ceiling (Main)", "2025-11-16", "2025-11-19", 0, 0, "30", "32"], ["34", "Set Out & Material \u2013 Electrical (Main)", "2025-11-19", "2025-11-21", 0, 0, "30", "31,32,33"], ["35", "Wiring & Piping Relocation (Main)", "2025-11-21", "2025-11-23", 0, 0, "30", "34"], ["36", "Wall Mod (VIP Room \u2013 Shera)", "2025-11-19", "2025-11-22", 0, 0, "30", "31,32,33"], ["38", "Outdoor Touch Up (Demo/Render/Gravel)", "2025-11-19", "2025-11-23", 0, 0, "30", "23"], ["39", "Tiles at Foyer", "2025-11-23", "2025-11-25", 0, 0, "30", "38"], ["42", "Install Signage (Main)", "2025-12-02", "2025-12-04", 0, 0, "30", "41,28"]];
const STORAGE_KEY='kbb_v3_done';
const nameMap={}; RAW.forEach(t=>nameMap[t[0]]=t[1]);
let doneSet=new Set(JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'));
let currentFormat='day', currentQuery='';

function saveSet(){localStorage.setItem(STORAGE_KEY,JSON.stringify([...doneSet]));}
function clearSet(){doneSet.clear();saveSet();}
function daysBetween(a,b){return Math.max(1,Math.round((new Date(b)-new Date(a))/86400000));}
function computeOverall(){const leaves=RAW.filter(t=>t[5]===0);return Math.round(100*leaves.filter(t=>doneSet.has(t[0])).length/leaves.length);}
function childrenOf(id){return RAW.filter(t=>t[6]==id);}
function isGroupDone(id){const kids=childrenOf(id);return kids.length>0 && kids.every(t=>t[5]==1?isGroupDone(t[0]):doneSet.has(t[0]));}

function render(){
  const el=document.getElementById('GanttChartDIV'); el.innerHTML=''; // clear
  const g=new JSGantt.GanttChart(el,currentFormat);
  g.setOptions({vShowComp:1,vShowStartDate:1,vShowEndDate:1,vDayColWidth:30,vWeekColWidth:120,vMonthColWidth:180});

  RAW.filter(t=>t[1].toLowerCase().includes(currentQuery.toLowerCase())).forEach(t=>{
    const[id,name,start,end,prog,group,parent,dep]=t;
    const done=doneSet.has(id);
    const gDone=(group==1)?isGroupDone(id):false;
    const bar=(done||gDone)?'gtaskdone':(group?'ggroupblack':'gtaskblue');
    g.AddTaskItem(new JSGantt.TaskItem(id,name,start,end,bar,'',0,'',prog,group,parent,1,dep,''));
  });

  g.Draw();

  const proj=RAW.find(t=>t[0]==='0');
  if(proj) document.getElementById('duration').innerText=daysBetween(proj[2],proj[3])+' hari';
  const ov=computeOverall(); document.getElementById('overall').innerText='Overall: '+ov+'%'; document.getElementById('statusNum').innerText=ov+'%';
  attachInteractions();
  positionTodayLine(g);
}

function attachInteractions(){
  // tooltip hover + click toggle
  RAW.forEach(t=>{
    const bar=document.getElementById('taskbar_'+t[0]);
    if(!bar) return;
    bar.style.cursor='pointer';
    const show=(ev)=>showTip(ev,t);
    const hide=()=>removeTips();
    bar.addEventListener('mouseenter',show);
    bar.addEventListener('mouseleave',hide);
    bar.addEventListener('click',(ev)=>{toggleDone(t[0]); showTip(ev,t);});
  });
}

function showTip(ev,t){
  removeTips();
  const[id,name,start,end]=t; const dur=daysBetween(start,end);
  const tip=document.createElement('div'); tip.className='tooltip';
  tip.innerHTML='<strong>'+name+'</strong><br>'+
    'ğŸ“… '+start+' â†’ '+end+' ('+dur+' hari)<br>'+
    'ğŸ§± Group: '+(nameMap[t[6]]||'-')+'<br>'+
    'ğŸ”— Dep: '+(t[7]||'-')+'<br>'+
    '<button id="btn">'+(doneSet.has(id)?'Mark as Not Done':'Mark Done')+'</button>';
  document.body.appendChild(tip);
  const r=ev.target.getBoundingClientRect();
  tip.style.left=(r.left+window.scrollX+16)+'px';
  tip.style.top=(r.top+window.scrollY-16)+'px';
  tip.querySelector('#btn').onclick=()=>{toggleDone(id)};
}
function removeTips(){document.querySelectorAll('.tooltip').forEach(x=>x.remove());}
function toggleDone(id){ if(doneSet.has(id)) doneSet.delete(id); else doneSet.add(id); saveSet(); render(); }

function positionTodayLine(g){
  // Approximate: align to start date visible in chart header
  const header=document.querySelector('.gminorheading:first-child');
  const line=document.getElementById('todayLine');
  const firstCell=document.querySelector('.gchartgrid th');
  if(!firstCell || !line) return;
  const startDate=new Date(RAW[0][2]);
  const today=new Date();
  const dayWidth= (currentFormat==='month')? 6 : (currentFormat==='week'? 18 : 30);
  const days=Math.floor((today-startDate)/(1000*60*60*24));
  line.style.left=(days*dayWidth)+'px';
}

document.getElementById('search').oninput=e=>{currentQuery=e.target.value;render();};
document.querySelectorAll('#scale button').forEach(b=>b.onclick=()=>{document.querySelectorAll('#scale button').forEach(x=>x.classList.remove('active'));b.classList.add('active');currentFormat=b.dataset.format;render();});
document.getElementById('resetBtn').onclick=()=>{if(confirm('Reset semua progress?')){clearSet();render();}};

render();
</script>
</body>
</html>
