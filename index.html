<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KBB Timeline ‚Äî Final Root Alignment</title>
<style>
:root{
  --bg:#0a0a0a;--panel:#121212;--ink:#e5e5e5;--muted:#9ca3af;
  --amber:#fbbf24;--amber600:#f59e0b;--blue1:#4b6cb7;--blue2:#182848;
  --emerald:#10b981;--border:#27272a;--red:#ef4444
}
*{box-sizing:border-box}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:var(--ink)}
.container{max-width:1200px;margin:0 auto;padding:24px}
.header{display:flex;gap:12px;align-items:flex-end;justify-content:space-between;flex-wrap:wrap}
.h-title{font-size:28px;font-weight:700}
.h-sub{color:var(--muted)}
.controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.chip{background:rgba(251,191,36,.12);color:var(--amber);padding:6px 10px;border-radius:999px;border:1px solid rgba(251,191,36,.25);font-size:13px}
.button{background:#0b0b0b;border:1px solid var(--border);color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer}
.button.active{background:#161616;color:#fff}
.panel{background:#121212;border:1px solid var(--border);border-radius:16px;padding:12px}
.gridhead{display:grid;grid-template-columns:1.5fr .5fr;gap:12px}
.input{width:100%;padding:10px;border-radius:12px;background:#0b0b0b;border:1px solid var(--border);color:var(--ink)}
.input:focus{border-color:var(--amber)}
.card{background:#18181b;border:1px solid var(--border);border-radius:16px;padding:16px}
.legend{font-size:12px;color:var(--muted);margin-top:8px}

/* Gantt */
.gantt{border:1px solid var(--border);border-radius:12px;overflow:auto;position:relative;min-height:460px;scroll-behavior:smooth}
.table{display:grid;grid-template-columns:320px 1fr;min-width:980px}
.left{position:sticky;left:0;background:#0f0f0f;border-right:1px solid var(--border);z-index:3}
.lrow{padding:8px 10px;border-bottom:1px solid var(--border);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.lrow.group{font-weight:700;color:var(--amber)}
.right{position:relative}
.rh{position:sticky;top:0;background:#0f0f0f;border-bottom:1px solid var(--border);z-index:2}
.monthbar,.scale2{display:flex;align-items:center;font-size:12px;color:#cbd5e1}
.monthbar{height:28px;border-bottom:1px solid #1f1f1f}
.scale2{height:26px;color:#a1a1aa;border-bottom:1px solid #1f1f1f}
.seg{display:flex;align-items:center;justify-content:flex-start;padding:0 8px;border-right:1px solid #1f1f1f}
.rgrid{position:relative;margin-left:1px}
.rrow{height:32px;border-bottom:1px dashed #1f1f1f}

/* Drawables */
.tl{position:absolute;width:2px;background:var(--red);z-index:9999;pointer-events:none;box-shadow:0 0 0 1px rgba(239,68,68,.3),0 0 10px rgba(239,68,68,.35)}
.bar{position:absolute;height:22px;border-radius:6px;transform:translateY(-50%);cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center;padding:0 6px;border:1px solid #3f3f46;z-index:5}
.bar.normal{background:linear-gradient(90deg,var(--blue1),var(--blue2));color:#e5e7eb;border-color:#415a9c}
.bar.group{background:linear-gradient(90deg,#fbbf24,#f59e0b);color:#1f2937;border-color:rgba(251,191,36,.35)}
.bar.done{background:linear-gradient(90deg,#34d399,#10b981);color:#053d2e;border-color:rgba(16,185,129,.45)}
.tooltip{position:absolute;background:#111;border:1px solid #333;color:#fff;font-size:12px;padding:8px 10px;border-radius:8px;max-width:280px;z-index:10;box-shadow:0 0 8px rgba(0,0,0,.45)}
.tooltip button{margin-top:6px;padding:4px 8px;border:0;border-radius:6px;background:#d97706;color:#fff;cursor:pointer}
.small{font-size:12px;color:#9ca3af}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <div class="h-title">KBB Steakhouse Project Timeline</div>
      <div class="h-sub">Kuala Terengganu ‚Ä¢ Nov‚ÄìDec 2025</div>
    </div>
    <div class="controls">
      <div class="chip" id="overallChip">Overall: 0%</div>
      <button class="button" id="resetBtn">üîÅ Reset Progress</button>
      <div class="button-group">
        <button class="button active" data-scale="day">Day</button>
        <button class="button" data-scale="week">Week</button>
        <button class="button" data-scale="month">Month</button>
      </div>
    </div>
  </div>

  <div class="gridhead">
    <div class="panel"><div class="small">Cari task</div>
      <input id="search" class="input" placeholder="Contoh: Ceiling, Signage, Plumbing">
    </div>
    <div class="panel" style="display:flex;align-items:center;justify-content:space-between">
      <div><div class="small">Status</div><div style="font-size:20px;color:var(--amber)" id="statusNum">0%</div></div>
      <div style="text-align:right"><div class="small">Total Duration</div><div style="font-size:20px" id="duration">‚Äî</div></div>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <div id="gantt" class="gantt"></div>
    <div class="legend">üö© Garis merah = tarikh hari ini ‚Ä¢ Hover/klik bar untuk info ‚Ä¢ Klik untuk tandakan siap ‚Ä¢ Reset untuk kosongkan status.</div>
  </div>
</div>

<script>
const RAW = [
["0","KBB STEAKHOUSE, KUALA TERENGGANU","2025-11-06","2025-12-05",null,true],
["1","Site Preparation","2025-11-06","2025-12-05"],
["2","Manufacture Site Hoarding","2025-11-06","2025-11-08"],
["3","Install Site Hoarding","2025-11-06","2025-11-08"],
["4","Circular Wing (Cover Dining & Toilet)","2025-11-07","2025-12-05",null,true],
["5","Site Delivery","2025-11-08","2025-12-05"],
["6","Marking Demolition Items/Location","2025-11-09","2025-11-10"],
["7","Demolish Floor Finish, Handwash & Steel Structure","2025-11-09","2025-11-12"],
["8","Erect Brickwall Exterior","2025-11-10","2025-11-15"],
["9","Plumbing Line for Handwash Area","2025-11-12","2025-11-13"],
["10","Erect Bricks at Toilet (Set Pipe)","2025-11-14","2025-11-16"],
["11","Erect Brickwalls at Photo Area","2025-11-16","2025-11-18"],
["12","Install Fittings at Toilet","2025-11-17","2025-11-18"],
["13","Install Tiles at Toilet","2025-11-18","2025-11-20"],
["14","Install Tiles at Handwash Area","2025-11-18","2025-11-20"],
["15","Paint Work (Circular Wing)","2025-11-20","2025-11-23"],
["16","Install Cabinetry (Circular Wing)","2025-11-25","2025-12-01"],
["17","Install Steel Structure","2025-11-25","2025-11-29"],
["18","Install Signage (Circular Wing)","2025-11-25","2025-11-28"],
["19","Install Door","2025-11-27","2025-11-29"],
["20","Main Wing","2025-11-28","2025-12-05",null,true],
["21","Demolish Floor Finish (Main)","2025-11-28","2025-11-30"],
["22","Demolish Wall Finish to Exposed Brick","2025-11-29","2025-12-01"],
["23","Demolish Ceiling (Main)","2025-11-29","2025-12-01"],
["24","Set Out & Material ‚Äì Electrical (Main)","2025-12-01","2025-12-02"],
["25","Wiring & Piping Relocation (Main)","2025-12-02","2025-12-03"],
["26","Wall Mod (VIP Room ‚Äì Shera)","2025-12-02","2025-12-04"],
["27","Outdoor Touch Up (Demo/Render/Gravel)","2025-12-03","2025-12-04"],
["28","Tiles at Foyer","2025-12-04","2025-12-05"],
["29","Install Signage (Main)","2025-12-04","2025-12-05"]
];

const $=s=>document.querySelector(s);
const P=d=>new Date(d+"T00:00:00");
const diff=(a,b)=>Math.round((P(b)-P(a))/86400000);
const start=RAW.find(t=>t[0]==="0")[2], end=RAW.find(t=>t[0]==="0")[3];
let done=new Set(JSON.parse(localStorage.getItem("kbb_done")||"[]"));
let SCALE="day",QUERY="";
const ROW_H=32,PX=()=>SCALE==="day"?30:(SCALE==="week"?10:4);

function render(){
  const gantt=$("#gantt"); gantt.innerHTML="";
  const table=document.createElement("div"); table.className="table"; gantt.appendChild(table);
  const left=document.createElement("div"); left.className="left"; table.appendChild(left);
  const right=document.createElement("div"); right.className="right"; table.appendChild(right);

  const rh=document.createElement("div"); rh.className="rh"; right.appendChild(rh); rh.appendChild(buildHeader());
  const rgrid=document.createElement("div"); rgrid.className="rgrid"; right.appendChild(rgrid);

  const rows=RAW.filter(t=>t[1].toLowerCase().includes((QUERY||"").toLowerCase()));
  rows.forEach(t=>{const l=document.createElement("div");l.className="lrow"+(t[5]?" group":"");l.textContent=t[1];left.appendChild(l);rgrid.appendChild(Object.assign(document.createElement("div"),{className:"rrow"}));});
  const totalDays=diff(start,end)+1,px=PX(),bufferDays=3;rgrid.style.width=(totalDays+bufferDays)*px+"px";

  const todayStr=new Date().toLocaleDateString('en-CA');
  const todayOffset=Math.min(Math.max(0,diff(start,todayStr)),diff(start,end));
  const tl=document.createElement("div");tl.className="tl";tl.style.height=(rows.length*ROW_H)+"px";tl.style.left=(todayOffset*px)+"px";rgrid.appendChild(tl);

  let offset=-1;
  rows.forEach((t,i)=>{
    const [id,name,s,e,_,grp]=t;
    if(id==="0"){offset--;return;} // skip root bar
    const x=(diff(start,s))*px;
    const w=(diff(s,e)+1)*px;
    const y=(i+offset)*ROW_H+ROW_H/2;
    const d=document.createElement("div");
    d.className="bar "+(grp?"group ":"normal ")+(done.has(id)?"done":"");
    d.style.left=x+"px";d.style.width=w+"px";d.style.top=y+"px";
    d.addEventListener("mouseenter",ev=>showTip(ev,t));
    d.addEventListener("mouseleave",hideTips);
    d.addEventListener("click",()=>{done.has(id)?done.delete(id):done.add(id);localStorage.setItem("kbb_done",JSON.stringify([...done]));render();});
    rgrid.appendChild(d);
  });

  const leaves=RAW.filter(t=>!t[5]&&t[0]!=="0");
  const pct=Math.round(100*leaves.filter(t=>done.has(t[0])).length/(leaves.length||1));
  $("#overallChip").textContent="Overall: "+pct+"%";
  $("#statusNum").textContent=pct+"%";
  $("#duration").textContent=(totalDays)+" hari";
  gantt.scrollLeft=Math.max(0,320+(todayOffset*px)-(gantt.clientWidth-320)/2);
}

function buildHeader(){
  const wrap=document.createElement("div");
  const totalDays=diff(start,end)+1,px=PX(),width=(totalDays+3)*px;
  const m=document.createElement("div");m.className="monthbar";m.style.width=width+"px";
  let c=P(start),last=P(end);
  while(c<=last){
    const seg=document.createElement("div");
    seg.className="seg";seg.style.width=(30*px)+"px";
    seg.textContent=new Intl.DateTimeFormat('en',{month:'short',year:'2-digit'}).format(c);
    m.appendChild(seg);c=new Date(c.getFullYear(),c.getMonth()+1,1);
  }
  wrap.appendChild(m);
  const s2=document.createElement("div");s2.className="scale2";s2.style.width=width+"px";
  let d=new Date(start);
  for(let i=0;i<totalDays;i++){
    const cell=document.createElement("div");
    cell.className="seg";cell.style.width=px+"px";cell.textContent=d.getDate();
    s2.appendChild(cell);d.setDate(d.getDate()+1);
  }
  wrap.appendChild(s2);return wrap;
}

function hideTips(){document.querySelectorAll('.tooltip').forEach(n=>n.remove());}
function showTip(ev,t){
  hideTips();
  const[id,name,s,e,_,grp]=t,dur=diff(s,e)+1;
  const tip=document.createElement("div");tip.className="tooltip";
  tip.innerHTML=`<strong>${name}</strong><br>üìÖ ${s} ‚Üí ${e} (${dur} hari)<br>`+
  (grp?`<span class="small">Group task</span>`:`<button>${(done.has(id)?'Mark as Not Done':'Mark Done')}</button>`);
  document.body.appendChild(tip);
  const r=ev.target.getBoundingClientRect();
  tip.style.left=(r.left+window.scrollX+12)+"px";tip.style.top=(r.top+window.scrollY-10)+"px";
  const btn=tip.querySelector("button");
  if(btn){btn.onclick=()=>{done.has(id)?done.delete(id):done.add(id);
    localStorage.setItem("kbb_done",JSON.stringify([...done]));render();};}
}

$("#search").addEventListener("input",e=>{QUERY=e.target.value;render();});
document.querySelectorAll(".button-group .button").forEach(b=>b.addEventListener("click",()=>{
  document.querySelectorAll(".button-group .button").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");SCALE=b.dataset.scale;render();
}));
$("#resetBtn").addEventListener("click",()=>{if(confirm("Reset semua progress?")){localStorage.removeItem("kbb_done");done=new Set();render();}});
render();
</script>
</body>
</html>
