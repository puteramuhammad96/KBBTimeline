
<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KBB Timeline ‚Äî Pro Amber v3 Fixed</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsgantt-improved@2.9.3/dist/jsgantt.css">
<link rel="stylesheet" href="./assets/style.css">
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <div class="h-title">KBB Steakhouse Project Timeline</div>
      <div class="h-sub">Kuala Terengganu ‚Ä¢ Nov‚ÄìDec 2025</div>
    </div>
    <div class="controls">
      <div class="chip" id="overall">Overall: 0%</div>
      <button class="reset-btn" id="resetBtn">üîÅ Reset Progress</button>
      <div class="btns" id="scale">
        <button data-format="day" class="active">Day</button>
        <button data-format="week">Week</button>
        <button data-format="month">Month</button>
      </div>
    </div>
  </div>

  <div class="grid" style="margin-top:16px">
    <div class="panel">
      <div style="font-size:12px;color:#9ca3af">Cari task</div>
      <input id="search" class="input" placeholder="Contoh: Ceiling, Signage, Plumbing"/>
    </div>
    <div class="panel" style="display:flex;align-items:center;justify-content:space-between">
      <div>
        <div style="font-size:12px;color:#9ca3af">Status</div>
        <div style="font-size:20px;color:#fbbf24" id="statusNum">0%</div>
      </div>
      <div style="text-align:right">
        <div style="font-size:12px;color:#9ca3af">Total Duration</div>
        <div style="font-size:20px" id="duration">‚Äî</div>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:12px;">
    <div class="gantt-wrap">
      <div class="today-line" id="todayLine"></div>
      <div class="gantt" id="GanttChartDIV"><div class="fallback">Memuat carta Gantt...</div></div>
    </div>
    <div class="legend">üö© Garis merah = tarikh hari ini ‚Ä¢ Klik bar untuk tandakan siap ‚Ä¢ Auto expand semua task.</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jsgantt-improved@2.9.3/dist/jsgantt.js"></script>
<script>
const RAW = [["0", "KBB STEAKHOUSE, KUALA TERENGGANU", "2025-11-06", "2025-12-04", 0, 1, "0", ""], ["1", "Site Preparation", "2025-11-06", "2025-11-07", 0, 0, "0", ""], ["2", "Manufacture Site Hoarding", "2025-11-06", "2025-11-06", 0, 0, "1", ""], ["3", "Install Site Hoarding", "2025-11-07", "2025-11-07", 0, 0, "1", "2"], ["4", "Circular Wing (Cover Dining & Toilet)", "2025-11-08", "2025-12-04", 0, 1, "0", "3"], ["5", "Site Delivery", "2025-11-08", "2025-11-11", 0, 0, "4", "3"], ["6", "Demolish Floor Finish", "2025-11-08", "2025-11-10", 0, 0, "4", "5"], ["7", "Install Ceiling", "2025-11-23", "2025-11-25", 0, 0, "4", "6"], ["8", "Paint Work", "2025-11-25", "2025-11-28", 0, 0, "4", "7"]];
const STORAGE_KEY='kbb_v3_fixed_done';
let doneSet=new Set(JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'));
let currentFormat='day';

function saveSet(){localStorage.setItem(STORAGE_KEY,JSON.stringify([...doneSet]));}
function clearSet(){doneSet.clear();saveSet();}
function daysBetween(a,b){return Math.max(1,Math.round((new Date(b)-new Date(a))/86400000));}
function computeOverall(){const leaves=RAW.filter(t=>t[5]===0);return Math.round(100*leaves.filter(t=>doneSet.has(t[0])).length/leaves.length);}

function render(){try{const g=new JSGantt.GanttChart(document.getElementById('GanttChartDIV'),currentFormat);
g.setOptions({vShowComp:1,vShowStartDate:1,vShowEndDate:1,vDayColWidth:30,vWeekColWidth:120,vMonthColWidth:180,vUseSingleCell:100});
RAW.forEach(t=>{const[id,name,start,end,prog,group,parent,dep]=t;const done=doneSet.has(id);
const bar=done?'gtaskdone':(group?'ggroupblack':'gtaskblue');g.AddTaskItem(new JSGantt.TaskItem(id,name,start,end,bar,'',0,'',prog,group,parent,1,dep,''));});
g.Draw();
document.getElementById('GanttChartDIV').querySelector('.fallback')?.remove();
const proj=RAW[0];document.getElementById('duration').innerText=daysBetween(proj[2],proj[3])+' hari';
document.getElementById('overall').innerText='Overall: '+computeOverall()+'%';document.getElementById('statusNum').innerText=computeOverall()+'%';
drawTodayLine();}catch(e){document.getElementById('GanttChartDIV').innerHTML='<div class="fallback">‚ö†Ô∏è Carta gagal dimuat. Pastikan sambungan internet untuk library JS Gantt.</div>';console.error(e);}
}

function drawTodayLine(){const today=new Date();const start=new Date(RAW[0][2]);
const diffDays=Math.floor((today-start)/(1000*60*60*24));document.getElementById('todayLine').style.left=(diffDays*30)+'px';}
document.getElementById('resetBtn').onclick=()=>{if(confirm('Reset semua progress?')){clearSet();render();}};
render();
</script>
</body>
</html>
